with 

picks as (

select OP.operatorName 'Associate',
OP.operatorID 'ID',
P.orderId 'Ref_#',
O.poNumber 'PO_#',
O.billingName 'Customer',
P.itemId 'Item',
P.qty 'Qty',
P.uom 'Pick_Type',
format (P.pickStamp, 'yyyy-MM-dd') 'Day'
from NuminaData_BaseTables.dbo.HK_Numina_psPicks_raw P
join NuminaData_BaseTables.dbo.HK_Numina_proOperators_raw OP on P.operatorId = OP.operatorID
join NuminaData_BaseTables.dbo.HK_Numina_psOrders_raw O on P.orderId = O.orderId
where P.pickable = 'true' and P.status = 'complete' AND p.uom = 'ea'

			),

duration as (


select
    OP.operatorID 'ID',
    T.startDate 'day',
	datediff (hour, (min(OP.startTime)), (max(OP.endTime))) 'time_spent'
from
    NuminaData_BaseTables.dbo.[HK_Numina_ proOperatorLog_raw] OP
    join NuminaData_BaseTables.dbo.HK_Numina_proTracker_raw T on OP.operatorID = T.operatorID
where
    format(OP.startTime, 'yyyy-MM-dd') = format(OP.endTime, 'yyyy-MM-dd')
    and format(OP.startTime, 'yyyy-MM-dd') = T.startDate
    and OP.task = 'cartpick'
    and T.task = 'cartpick'
group by
    OP.operatorID,
    T.startDate
				),

qty_picked as	(

    select
        sum (value) 'qty picked',
        operatorID 'ID',
        startDate 'day'
    from
        NuminaData_BaseTables.dbo.HK_Numina_proTracker_raw
    where
        task = 'cartpick'
    group by
        operatorID,
        startDate
				)

	select 
	p.Associate,
	p.Customer,
	p.[Day],
	p.Item,
	p.Pick_Type,
	p.PO_#,
	p.Qty,
	p.Ref_#,
	d.time_spent,
	q.[qty picked]
	
	from picks p, duration d, qty_picked q
	where 
	p.ID = d.ID 
	and Q.ID = d.ID
	and  p.[Day] = d.[day]
	and d.[day] = q.[day]
	
